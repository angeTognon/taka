# Commandes rapides - Copier/coller directement dans votre terminal SSH
# Vous êtes actuellement dans: ~/domains/takaafrica.com/public_html

# 1. Remonter au niveau du domaine
cd ~/domains/takaafrica.com

# 2. Créer laravel et déplacer les fichiers
mkdir -p laravel
mv public_html/app laravel/ && mv public_html/artisan laravel/ && mv public_html/bootstrap laravel/
mv public_html/composer.json laravel/ && mv public_html/composer.lock laravel/
mv public_html/config laravel/ && mv public_html/database laravel/
mv public_html/resources laravel/ && mv public_html/routes laravel/
mv public_html/storage laravel/

# 3. Déplacer le contenu de public/ vers public_html/
cd public_html && mv public/* . 2>/dev/null; mv public/.* . 2>/dev/null; rmdir public 2>/dev/null || true

# 4. Modifier index.php
cat > index.php << 'EOF'
<?php
use Illuminate\Foundation\Application;
use Illuminate\Http\Request;
define('LARAVEL_START', microtime(true));
if (file_exists($maintenance = __DIR__.'/../laravel/storage/framework/maintenance.php')) {
    require $maintenance;
}
require __DIR__.'/../laravel/vendor/autoload.php';
$app = require_once __DIR__.'/../laravel/bootstrap/app.php';
$app->handleRequest(Request::capture());
EOF

# 5. Créer .env et installer
cd ../laravel
cat > .env << 'ENVEOF'
APP_NAME="TAKA"
APP_ENV=production
APP_KEY=
APP_DEBUG=false
APP_URL=https://takaafrica.com
LOG_CHANNEL=stack
LOG_LEVEL=error
DB_CONNECTION=mysql
DB_HOST=localhost
DB_PORT=3306
DB_DATABASE=
DB_USERNAME=
DB_PASSWORD=
SESSION_DRIVER=file
SESSION_LIFETIME=120
CACHE_DRIVER=file
QUEUE_CONNECTION=sync
ENVEOF

# 6. Installer, générer clé, permissions, optimiser
composer install --no-dev --optimize-autoloader
php artisan key:generate
chmod -R 775 storage bootstrap/cache
php artisan config:cache
php artisan route:cache
php artisan view:cache

echo "✅ Installation terminée!"
echo "⚠️  IMPORTANT: Éditez .env avec vos vraies informations DB, puis exécutez: php artisan migrate --force"

