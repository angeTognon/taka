# Commandes pour finaliser la mise en ligne sur Hostinger
# Vous Ãªtes actuellement dans: ~/domains/takaafrica.com/public_html

# ============================================
# Ã‰TAPE 1 : Remonter au niveau du domaine
# ============================================
cd ~/domains/takaafrica.com

# ============================================
# Ã‰TAPE 2 : CrÃ©er le dossier laravel et dÃ©placer le contenu
# ============================================
mkdir -p laravel
mv public_html/app laravel/
mv public_html/artisan laravel/
mv public_html/bootstrap laravel/
mv public_html/composer.json laravel/
mv public_html/composer.lock laravel/
mv public_html/config laravel/
mv public_html/database laravel/
mv public_html/package.json laravel/
mv public_html/pharmaRh laravel/ 2>/dev/null || true
mv public_html/resources laravel/
mv public_html/routes laravel/
mv public_html/storage laravel/
mv public_html/vite.config.js laravel/ 2>/dev/null || true
mv public_html/README.md laravel/ 2>/dev/null || true
mv public_html/README_TAKA.md laravel/ 2>/dev/null || true
mv public_html/GUIDE_DEPLOIEMENT.md laravel/ 2>/dev/null || true
mv public_html/unzipper.php laravel/ 2>/dev/null || true
mv public_html/nginx.conf.example laravel/ 2>/dev/null || true

# Ne pas dÃ©placer: public, .htaccess, backup, my-app-deploy-*.zip

# ============================================
# Ã‰TAPE 3 : DÃ©placer le contenu de public/ vers public_html/
# ============================================
cd public_html
mv public/* .
mv public/.* . 2>/dev/null || true
rmdir public 2>/dev/null || true

# ============================================
# Ã‰TAPE 4 : Modifier index.php pour pointer vers ../laravel/
# ============================================
cat > index.php << 'EOF'
<?php

use Illuminate\Foundation\Application;
use Illuminate\Http\Request;

define('LARAVEL_START', microtime(true));

if (file_exists($maintenance = __DIR__.'/../laravel/storage/framework/maintenance.php')) {
    require $maintenance;
}

require __DIR__.'/../laravel/vendor/autoload.php';

/** @var Application $app */
$app = require_once __DIR__.'/../laravel/bootstrap/app.php';

$app->handleRequest(Request::capture());
EOF

# ============================================
# Ã‰TAPE 5 : Aller dans le dossier laravel et crÃ©er .env
# ============================================
cd ../laravel

# CrÃ©er le fichier .env (vous devrez le modifier avec vos vraies informations)
cat > .env << 'ENVEOF'
APP_NAME="TAKA"
APP_ENV=production
APP_KEY=
APP_DEBUG=false
APP_URL=https://takaafrica.com

LOG_CHANNEL=stack
LOG_LEVEL=error

DB_CONNECTION=mysql
DB_HOST=localhost
DB_PORT=3306
DB_DATABASE=u914969601_takaapp
DB_USERNAME=u914969601_takaapp
DB_PASSWORD=Guyaapp02@

SESSION_DRIVER=file
SESSION_LIFETIME=120
CACHE_DRIVER=file
QUEUE_CONNECTION=sync
ENVEOF

echo "âš ï¸  IMPORTANT: Modifiez le fichier .env avec vos vraies informations de base de donnÃ©es!"
echo "   Utilisez: nano .env"
echo "   Ou Ã©ditez-le via le gestionnaire de fichiers Hostinger"

# ============================================
# Ã‰TAPE 6 : Installer les dÃ©pendances Composer
# ============================================
composer install --no-dev --optimize-autoloader

# ============================================
# Ã‰TAPE 7 : GÃ©nÃ©rer la clÃ© d'application
# ============================================
php artisan key:generate

# ============================================
# Ã‰TAPE 8 : Configurer les permissions
# ============================================
chmod -R 775 storage bootstrap/cache

# ============================================
# Ã‰TAPE 9 : ExÃ©cuter les migrations (aprÃ¨s avoir configurÃ© .env)
# ============================================
# php artisan migrate --force
echo "âš ï¸  N'oubliez pas d'exÃ©cuter: php artisan migrate --force (aprÃ¨s avoir configurÃ© .env)"

# ============================================
# Ã‰TAPE 10 : Optimiser pour la production
# ============================================
php artisan config:cache
php artisan route:cache
php artisan view:cache

# ============================================
# Ã‰TAPE 11 : VÃ©rifier la structure
# ============================================
cd ~/domains/takaafrica.com
echo ""
echo "âœ… Structure finale:"
ls -la
echo ""
echo "ðŸ“ Contenu de public_html:"
ls -la public_html/ | head -15
echo ""
echo "ðŸ“ Contenu de laravel:"
ls -la laravel/ | head -15

